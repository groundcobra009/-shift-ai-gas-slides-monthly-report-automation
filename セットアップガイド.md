# 月次売上レポート自動生成システム - セットアップガイド

## 📋 概要

このシステムは、Googleスプレッドシートのデータを基にGoogleスライドを自動生成します。
ダイアログUIから簡単に操作でき、毎月自動実行することも可能です。

## 🚀 初回セットアップ手順

### ステップ1: スライドテンプレートの作成

1. 新しいGoogleスライドを作成
2. 4枚のスライドを作成し、以下のテキストを配置:

#### Slide 1: 表紙
```
{{reportTitle}}
{{targetYearMonth}}
Generated at {{generatedAt}}
```

#### Slide 2: KPIサマリー
```
タイトル: KPIサマリー

合計売上: {{totalSales}}
目標売上: {{targetSales}}
達成率: {{achievementRate}}
前月比: {{momGrowth}}
前年比: {{yoyGrowth}}

コメント: {{comment}}
```

#### Slide 3: 月次推移
```
タイトル: 月次推移

（チャートエリア - 空白のまま）

{{trendSummary}}
```

#### Slide 4: 当月の内訳
```
タイトル: 当月の内訳

（左側: 地域別チャートエリア）
（右側: カテゴリ別チャートエリア）

{{insight}}
```

3. テンプレートのIDをメモ
   - URL: `https://docs.google.com/presentation/d/【ここがID】/edit`

### ステップ2: 出力先フォルダの作成

1. Google Driveで新しいフォルダを作成（例: 「月次レポート」）
2. フォルダのIDをメモ
   - URL: `https://drive.google.com/drive/folders/【ここがID】`

### ステップ3: スプレッドシートでの設定

1. スプレッドシートを開く
2. メニューバーに「📊 月次レポート」が表示されます
3. **「📊 月次レポート」→「設定を表示」**を選択
4. 以下を入力:
   - **スライドテンプレートID**: ステップ1でメモしたID
   - **出力先フォルダID**: ステップ2でメモしたID
   - **対象年月**: 例: `2026-01`
   - **レポートタイトル**: 例: `月次売上レポート`
   - **出力モード**: `CREATE_NEW`（推奨）
5. 「保存」ボタンをクリック

### ステップ4: サンプルデータの生成（初回のみ）

1. **「📊 月次レポート」→「サンプルデータ生成」**を選択
2. 対象年月を入力（例: `2026-01`）
3. 「生成開始」ボタンをクリック
4. 以下のシートが自動生成されます:
   - **KPI**: KPIデータ
   - **MonthlySales**: 月次売上データ + 折れ線グラフ
   - **RegionalSales**: 地域別売上データ + 棒グラフ
   - **CategorySales**: カテゴリ別売上データ + 円グラフ

### ステップ5: レポート生成テスト

1. **「📊 月次レポート」→「レポート生成」**を選択
2. 対象年月と出力モードを確認
3. 「生成開始」ボタンをクリック
4. 完了後、スライドのリンクが表示されるのでクリックして確認

## 💡 使い方

### 日常的な使い方

#### 手動でレポート生成

1. データシート（MonthlySales、RegionalSales、CategorySales、KPI）を更新
2. **「📊 月次レポート」→「レポート生成」**を選択
3. 対象年月を選択（クイックボタン「今月」「先月」「来月」も利用可能）
4. 出力モードを選択:
   - **CREATE_NEW**: 毎回新しいスライドを作成
   - **UPDATE_LATEST**: 前回のスライドを上書き
5. 「生成開始」ボタンをクリック

#### 自動実行設定

1. **「📊 月次レポート」→「トリガー設定」**を選択
2. 「毎月1日に実行（作成）」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. 以降、毎月1日の午前9時に自動でレポートが生成されます

## 📊 データ更新方法

### 毎月のデータ更新手順

1. **MonthlySalesシート**: 新しい月のデータを追加
   ```
   YearMonth | Sales     | YoY  | Memo
   2026-02   | 15000000  | 1.10 | -
   ```

2. **RegionalSalesシート**: 新しい月の地域別データを追加
   ```
   YearMonth | Region | Sales
   2026-02   | 北海道  | 1300000
   2026-02   | 東北    | 1900000
   ...
   ```

3. **CategorySalesシート**: 新しい月のカテゴリ別データを追加
   ```
   YearMonth | Category   | Sales
   2026-02   | サブスク    | 3500000
   2026-02   | 単発        | 3000000
   ...
   ```

4. **KPIシート**: KPIデータを更新
   ```
   Key              | Value
   YearMonth        | 2026-02
   TotalSales       | 15000000
   TargetSales      | 15000000
   AchievementRate  | 1.0
   MoMGrowth        | 0.15
   YoYGrowth        | 0.10
   Comment          | 目標達成!
   ```

5. **Configシート**: 対象年月を更新（必要に応じて）
   ```
   targetYearMonth | 2026-02
   ```

## 🛠️ トラブルシューティング

### よくあるエラーと解決方法

#### エラー: "slideTemplateIdが設定されていません"
**原因**: スライドテンプレートIDが未設定
**解決**: 設定ダイアログからテンプレートIDを入力

#### エラー: "outputFolderIdが設定されていません"
**原因**: 出力先フォルダIDが未設定
**解決**: 設定ダイアログからフォルダIDを入力

#### エラー: "KPIデータの対象年月が一致しません"
**原因**: KPIシートのYearMonthとConfigのtargetYearMonthが異なる
**解決**: KPIシートのYearMonthを更新

#### チャートが貼り付けられない
**原因**: チャートが存在しない
**解決**:
1. 各シート（MonthlySales、RegionalSales、CategorySales）を確認
2. チャートが無い場合は、サンプルデータ生成を再実行

#### トリガーが動作しない
**原因**: トリガーが正しく設定されていない
**解決**: トリガー設定ダイアログでトリガーを確認・再作成

## 📝 カスタマイズ

### テンプレートのカスタマイズ

スライドテンプレートで使用できる変数:

| 変数 | 説明 | 例 |
|------|------|-----|
| `{{reportTitle}}` | レポートタイトル | 月次売上レポート |
| `{{targetYearMonth}}` | 対象年月 | 2026-01 |
| `{{generatedAt}}` | 生成日時 | 2026-01-10 15:30 |
| `{{totalSales}}` | 合計売上 | 14,500,000円 |
| `{{targetSales}}` | 目標売上 | 15,000,000円 |
| `{{achievementRate}}` | 達成率 | +96.7% |
| `{{momGrowth}}` | 前月比成長率 | +12.0% |
| `{{yoyGrowth}}` | 前年比成長率 | +8.0% |
| `{{comment}}` | コメント | 好調を維持しています |
| `{{trendSummary}}` | トレンドサマリー | 直近3ヶ月は上昇傾向 |
| `{{insight}}` | インサイト | 関東地域が約36% |

### データ構造のカスタマイズ

必要に応じて、以下をカスタマイズできます:

- **地域リスト**: `RegionalSalesシート` + `generateSampleRegionalSalesData_()関数`
- **カテゴリリスト**: `CategorySalesシート` + `generateSampleCategorySalesData_()関数`
- **KPI項目**: `KPIシート` + `getKpi_()関数` + `buildPayload_()関数`

## 📞 サポート

問題が解決しない場合は、以下を確認してください:

1. **実行ログの確認**: Logシートで詳細なエラーメッセージを確認
2. **権限の確認**: Google Drive、Google Slides、Google Sheetsへのアクセス権限を確認
3. **ID の確認**: スライドテンプレートIDとフォルダIDが正しいか再確認

## 🎉 完了!

これでセットアップは完了です。
月次レポートの自動生成をお楽しみください!
