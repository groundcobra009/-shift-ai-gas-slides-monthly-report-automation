<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 24px;
      background: linear-gradient(135deg, #0f9d58 0%, #0b8043 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 650px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #0f9d58 0%, #0b8043 100%);
      color: white;
      padding: 32px 24px;
      text-align: center;
    }
    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }
    .content {
      padding: 32px 24px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #4b5563;
      font-size: 14px;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }
    input[type="text"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: #0f9d58;
      box-shadow: 0 0 0 3px rgba(15, 157, 88, 0.1);
    }
    .help-text {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 6px;
      line-height: 1.5;
    }
    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin-top: 32px;
    }
    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #0f9d58 0%, #0b8043 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(15, 157, 88, 0.4);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(15, 157, 88, 0.5);
    }
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #4b5563;
    }
    .btn-secondary:hover {
      background: #d1d5db;
    }
    .result {
      display: none;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .result.show { display: block; }
    .result.success {
      background: #d1fae5;
      border: 2px solid #6ee7b7;
      color: #065f46;
    }
    .result.error {
      background: #fee2e2;
      border: 2px solid #fca5a5;
      color: #991b1b;
    }
    .warning-box {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 13px;
      color: #92400e;
    }
    .readonly {
      background: #f3f4f6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”§ è©³ç´°è¨­å®š</h1>
      <p>ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä¿å­˜ã•ã‚Œã¾ã™</p>
    </div>

    <div class="content">
      <div id="result" class="result"></div>

      <div class="form-group">
        <label for="reportTitle">ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«</label>
        <input type="text" id="reportTitle" placeholder="æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ" />
      </div>

      <div class="form-group">
        <label for="slideTemplateId">ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰</label>
        <input type="text" id="slideTemplateId" class="readonly" readonly />
        <div class="help-text">åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§è‡ªå‹•è¨­å®šã•ã‚Œã¾ã™</div>
      </div>

      <div class="form-group">
        <label for="outputFolderId">å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€IDï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰</label>
        <input type="text" id="outputFolderId" class="readonly" readonly />
        <div class="help-text">åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§è‡ªå‹•è¨­å®šã•ã‚Œã¾ã™</div>
      </div>

      <div class="form-group">
        <label for="geminiApiKey">Gemini APIã‚­ãƒ¼ï¼ˆä»»æ„ãƒ»æ©Ÿå¯†æƒ…å ±ï¼‰</label>
        <input type="password" id="geminiApiKey" placeholder="AIxxxxxxxxxxxxxxxxxxxxxxx" />
        <div class="help-text">
          å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç©ºæ¬„ã®å ´åˆã¯å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ï¼‰<br>
          å–å¾—æ–¹æ³•: <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>
        </div>
      </div>

      <div class="form-group">
        <label>ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰IDï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰</label>
        <input type="text" id="currentSlideId" class="readonly" readonly />
        <div class="help-text">æœ€å¾Œã«ç”Ÿæˆã—ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã®IDï¼ˆè‡ªå‹•æ›´æ–°ï¼‰</div>
      </div>

      <div class="warning-box">
        âš ï¸ ã€Œãƒªã‚»ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æ¬¡å›ã¯æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ãŒä½œæˆã•ã‚Œã¾ã™
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜</button>
        <button class="btn btn-danger" onclick="resetSlideId()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="btn btn-secondary" onclick="google.script.host.close()">âœ• é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <script>
    window.onload = function() {
      loadSettings();
    };

    function loadSettings() {
      google.script.run
        .withSuccessHandler(function(config) {
          document.getElementById('reportTitle').value = config.reportTitle || '';
          document.getElementById('slideTemplateId').value = config.slideTemplateId || 'ï¼ˆæœªè¨­å®šï¼‰';
          document.getElementById('outputFolderId').value = config.outputFolderId || 'ï¼ˆæœªè¨­å®šï¼‰';
          document.getElementById('currentSlideId').value = config.currentSlideId || 'ï¼ˆæœªè¨­å®šï¼‰';

          // APIã‚­ãƒ¼ã¯ãƒã‚¹ã‚¯ã•ã‚ŒãŸã‚‚ã®ã‚’è¡¨ç¤ºï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã—ã¦ï¼‰
          if (config.geminiApiKeyMasked) {
            document.getElementById('geminiApiKey').placeholder = config.geminiApiKeyMasked;
          }
        })
        .withFailureHandler(function(error) {
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .getConfigForUI();
    }

    function saveSettings() {
      const config = {
        reportTitle: document.getElementById('reportTitle').value,
        geminiApiKey: document.getElementById('geminiApiKey').value
      };

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showResult(true, 'âœ… ' + result.message);
            // APIã‚­ãƒ¼å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('geminiApiKey').value = '';
            // è¨­å®šã‚’å†èª­ã¿è¾¼ã¿
            loadSettings();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .saveConfigFromUI(config);
    }

    function resetSlideId() {
      if (!confirm('ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰IDã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹?\n\næ¬¡å›ã¯æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ãŒä½œæˆã•ã‚Œã¾ã™ã€‚')) {
        return;
      }

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showResult(true, 'âœ… ' + result.message);
            document.getElementById('currentSlideId').value = 'ï¼ˆæœªè¨­å®šï¼‰';
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .resetCurrentSlideId();
    }

    function showResult(success, message) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = message;
      resultDiv.className = 'result show ' + (success ? 'success' : 'error');
    }
  </script>
</body>
</html>
