<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 0;
      background: #f8f9fa;
    }
    .header {
      background: linear-gradient(135deg, #0f9d58 0%, #0b8043 100%);
      color: white;
      padding: 20px 16px;
      text-align: center;
    }
    .header h2 {
      font-size: 18px;
      margin-bottom: 4px;
    }
    .header p {
      font-size: 12px;
      opacity: 0.9;
    }
    .section {
      background: white;
      margin: 12px;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .section-title {
      font-size: 13px;
      font-weight: 700;
      color: #0f9d58;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .info-box {
      background: #dbeafe;
      border-left: 4px solid #3b82f6;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 12px;
      color: #1e40af;
      line-height: 1.5;
    }
    .form-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #4b5563;
      font-size: 12px;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 13px;
      transition: all 0.3s;
    }
    input[type="text"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: #0f9d58;
      box-shadow: 0 0 0 3px rgba(15, 157, 88, 0.1);
    }
    select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 13px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    select:focus {
      outline: none;
      border-color: #0f9d58;
      box-shadow: 0 0 0 3px rgba(15, 157, 88, 0.1);
    }
    .help-text {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
      line-height: 1.4;
    }
    .readonly {
      background: #f3f4f6;
      cursor: not-allowed;
    }
    .btn {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 8px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #0f9d58 0%, #0b8043 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(15, 157, 88, 0.4);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(15, 157, 88, 0.5);
    }
    .btn-secondary {
      background: #e8f5e9;
      color: #0f9d58;
    }
    .btn-secondary:hover {
      background: #c8e6c9;
    }
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    .btn-danger:hover {
      background: #dc2626;
    }
    .result {
      display: none;
      padding: 12px;
      border-radius: 8px;
      margin: 12px;
      font-size: 12px;
      line-height: 1.6;
    }
    .result.show { display: block; }
    .result.success {
      background: #d1fae5;
      border: 2px solid #6ee7b7;
      color: #065f46;
    }
    .result.error {
      background: #fee2e2;
      border: 2px solid #fca5a5;
      color: #991b1b;
    }
    .result a {
      color: #0284c7;
      font-weight: 600;
      text-decoration: none;
    }
    .loading {
      display: none;
      text-align: center;
      padding: 16px;
      color: #0f9d58;
    }
    .loading.show { display: block; }
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #0f9d58;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
      margin: 0 auto 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .divider {
      height: 1px;
      background: #e5e7eb;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2>âš™ï¸ è¨­å®š</h2>
    <p>åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨è©³ç´°è¨­å®š</p>
  </div>

  <div id="result" class="result"></div>

  <!-- åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— -->
  <div class="section">
    <div class="section-title">ğŸš€ åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
    <div class="info-box">
      ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¹ãƒ©ã‚¤ãƒ‰ã¨å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã™ã€‚å€‹åˆ¥ã«ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
    </div>
    <button class="btn btn-primary" onclick="runInitialSetup()">
      âš¡ ã™ã¹ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    </button>
    <button class="btn btn-secondary" onclick="createTemplateOnly()">
      ğŸ“Š ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿ä½œæˆ
    </button>
    <button class="btn btn-secondary" onclick="createFolderOnly()">
      ğŸ“ å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ã®ã¿ä½œæˆ
    </button>
  </div>

  <div class="divider"></div>

  <!-- è©³ç´°è¨­å®š -->
  <div class="section">
    <div class="section-title">ğŸ”§ è©³ç´°è¨­å®š</div>
    <div class="info-box">
      ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã¯ã€æœˆæ¬¡/å¹´æ¬¡/é€±æ¬¡ã«å¿œã˜ã¦è‡ªå‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ï¼ˆã€Œæœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆã€ã€Œå¹´æ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆã€ã€Œé€±æ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆã€ï¼‰ã€‚
    </div>

    <div class="form-group">
      <label for="geminiApiKey">Gemini APIã‚­ãƒ¼ï¼ˆä»»æ„ï¼‰</label>
      <input type="password" id="geminiApiKey" placeholder="å¤‰æ›´ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›" />
      <div class="help-text">
        å–å¾—æ–¹æ³•: <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a><br>
        AIã‚³ãƒ¡ãƒ³ãƒˆã¨AIã‚¤ãƒ³ã‚µã‚¤ãƒˆã®è‡ªå‹•ç”Ÿæˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

    <button class="btn btn-secondary" onclick="saveSettings()">
      ğŸ’¾ è¨­å®šã‚’ä¿å­˜
    </button>

    <button class="btn btn-secondary" onclick="testGemini()">
      ğŸ”Œ Geminiæ¥ç¶šãƒ†ã‚¹ãƒˆ
    </button>
  </div>

  <div class="divider"></div>

  <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† -->
  <div class="section">
    <div class="section-title">ğŸ¨ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†</div>
    <div class="info-box">
      ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ãƒ»ä¿®æ­£ã‚’UIã‹ã‚‰æ“ä½œã§ãã¾ã™ã€‚
    </div>
    
    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ -->
    <div style="margin-bottom: 20px;">
      <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555;">ğŸ“Š ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ</h4>
      <button class="btn btn-primary" onclick="createTemplateOnly()" style="width: 100%;">
        âœ¨ æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ
      </button>
      <div class="help-text">æœˆæ¬¡ãƒ»å¹´æ¬¡ãƒ»é€±æ¬¡ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ–°è¦ä½œæˆã—ã¾ã™</div>
    </div>

    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–° -->
    <div style="margin-bottom: 20px;">
      <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555;">ğŸ”„ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°</h4>
      <button class="btn btn-secondary" onclick="updateTemplate()" style="width: 100%;">
        ğŸ”„ æ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›´æ–°
      </button>
      <div class="help-text">æ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æœ€æ–°ç‰ˆã«æ›´æ–°ã—ã¾ã™ï¼ˆæ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å‰Šé™¤ã•ã‚Œã¾ã™ï¼‰</div>
    </div>

    <!-- ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒå¤‰æ›´ -->
    <div style="margin-bottom: 20px;">
      <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555;">ğŸ¨ ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒå¤‰æ›´</h4>
      <div class="form-group" style="margin-bottom: 10px;">
        <select id="colorTheme" style="width: 100%;">
          <option value="green">ç·‘</option>
          <option value="monochrome">ãƒ¢ãƒãƒˆãƒ¼ãƒ³</option>
          <option value="blue">é’</option>
          <option value="red">èµ¤</option>
        </select>
      </div>
      <button class="btn btn-secondary" onclick="changeColorTheme()" style="width: 100%;">
        ğŸ¨ ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã‚’å¤‰æ›´
      </button>
      <div class="help-text">é¸æŠã—ãŸãƒ†ãƒ¼ãƒã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå†ä½œæˆã•ã‚Œã¾ã™</div>
    </div>

    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿®æ­£ -->
    <div style="margin-bottom: 20px;">
      <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555;">ğŸ”§ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿®æ­£</h4>
      <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
        <button class="btn btn-secondary" onclick="fixTemplatesTitle()" style="flex: 1; min-width: 150px;">
          ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«ã‚’{{reportTitle}}ã«çµ±ä¸€
        </button>
        <button class="btn btn-secondary" onclick="fixTemplates()" style="flex: 1; min-width: 150px;">
          ğŸ”§ {{period}}ã‚’å‰Šé™¤
        </button>
      </div>
      <div class="help-text">
        <strong>æ¨å¥¨é †åº:</strong> â‘ ã€Œã‚¿ã‚¤ãƒˆãƒ«ã‚’{{reportTitle}}ã«çµ±ä¸€ã€â†’ â‘¡ã€Œ{{period}}ã‚’å‰Šé™¤ã€
      </div>
    </div>

    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤ -->
    <div>
      <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #555;">ğŸ—‘ï¸ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤</h4>
      <button class="btn btn-danger" onclick="deleteTemplates()" style="width: 100%;">
        ğŸ—‘ï¸ ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤
      </button>
      <div class="help-text">æœˆæ¬¡ãƒ»å¹´æ¬¡ãƒ»é€±æ¬¡ã®ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ï¼ˆå‰Šé™¤å¾Œã¯å†ä½œæˆãŒå¿…è¦ã§ã™ï¼‰</div>
    </div>
  </div>

  <div class="divider"></div>

  <div class="divider"></div>

  <!-- ç¾åœ¨ã®è¨­å®šæƒ…å ± -->
  <div class="section">
    <div class="section-title">ğŸ“‹ ç¾åœ¨ã®è¨­å®š</div>

    <div class="form-group">
      <label>ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID</label>
      <input type="text" id="slideTemplateId" class="readonly" readonly />
    </div>

    <div class="form-group">
      <label>å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ID</label>
      <input type="text" id="outputFolderId" class="readonly" readonly />
    </div>

    <div class="form-group">
      <label>ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ID</label>
      <input type="text" id="currentSlideId" class="readonly" readonly />
      <div class="help-text">æœ€å¾Œã«ç”Ÿæˆã—ãŸã‚¹ãƒ©ã‚¤ãƒ‰ã®ID</div>
    </div>

    <button class="btn btn-danger" onclick="resetSlideId()">
      ğŸ”„ ã‚¹ãƒ©ã‚¤ãƒ‰IDã‚’ãƒªã‚»ãƒƒãƒˆ
    </button>
  </div>

  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p style="font-size: 12px;">å‡¦ç†ä¸­...</p>
  </div>

  <script>
    window.onload = function() {
      loadCurrentConfig();
    };

    function loadCurrentConfig() {
      google.script.run
        .withSuccessHandler(function(config) {
          document.getElementById('slideTemplateId').value = config.slideTemplateId || 'ï¼ˆæœªè¨­å®šï¼‰';
          document.getElementById('outputFolderId').value = config.outputFolderId || 'ï¼ˆæœªè¨­å®šï¼‰';
          document.getElementById('currentSlideId').value = config.currentSlideId || 'ï¼ˆæœªè¨­å®šï¼‰';
          
          // ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã‚’è¨­å®š
          if (config.colorTheme) {
            document.getElementById('colorTheme').value = config.colorTheme;
          }

          // APIã‚­ãƒ¼ã¯ãƒã‚¹ã‚¯ã•ã‚ŒãŸã‚‚ã®ã‚’ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«è¡¨ç¤º
          if (config.geminiApiKeyMasked) {
            document.getElementById('geminiApiKey').placeholder = config.geminiApiKeyMasked;
          }
        })
        .withFailureHandler(function(error) {
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .getConfigForUI();
    }

    function runInitialSetup() {
      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            let message = `âœ… ${result.message}<br><br>`;

            if (result.results.templateCreated) {
              message += `ğŸ“Š ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ–°è¦ä½œæˆï¼‰<br>`;
            } else {
              message += `ğŸ“Š ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ—¢å­˜ï¼‰<br>`;
            }
            message += `<a href="${result.results.templateUrl}" target="_blank">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é–‹ã</a><br><br>`;

            if (result.results.folderCreated) {
              message += `ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆæ–°è¦ä½œæˆï¼‰<br>`;
            } else {
              message += `ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆæ—¢å­˜ï¼‰<br>`;
            }
            message += `<a href="${result.results.folderUrl}" target="_blank">ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã</a>`;

            showResult(true, message);
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .setupInitialEnvironment();
    }

    function saveSettings() {
      const config = {
        geminiApiKey: document.getElementById('geminiApiKey').value
      };

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            showResult(true, 'âœ… ' + result.message);
            document.getElementById('geminiApiKey').value = '';
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .saveConfigFromUI(config);
    }

    function updateTemplate() {
      if (!confirm('ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æœ€æ–°ç‰ˆã«æ›´æ–°ã—ã¾ã™ã‹?\n\næ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        return;
      }

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            let message = `âœ… ${result.message}<br><br>`;
            message += `<a href="${result.templateUrl}" target="_blank">æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é–‹ã</a>`;
            showResult(true, message);
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .updateSlideTemplate();
    }

    function resetSlideId() {
      if (!confirm('ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰IDã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹?\n\næ¬¡å›ã¯æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ãŒä½œæˆã•ã‚Œã¾ã™ã€‚')) {
        return;
      }

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            showResult(true, 'âœ… ' + result.message);
            document.getElementById('currentSlideId').value = 'ï¼ˆæœªè¨­å®šï¼‰';
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .resetCurrentSlideId();
    }

    function createTemplateOnly() {
      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            let message = `âœ… ${result.message}<br><br>`;
            message += `<a href="${result.templateUrl}" target="_blank">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é–‹ã</a>`;
            showResult(true, message);
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .createSlideTemplateOnly();
    }

    function createFolderOnly() {
      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            let message = `âœ… ${result.message}<br><br>`;
            message += `<a href="${result.folderUrl}" target="_blank">ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã</a>`;
            showResult(true, message);
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .createOutputFolderOnly();
    }

    function testGemini() {
      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            let message = `âœ… ${result.message}<br><br>`;
            message += `<strong>ãƒ¬ã‚¹ãƒãƒ³ã‚¹:</strong><br>${result.response}`;
            showResult(true, message);
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .testGeminiConnection();
    }

    function changeColorTheme() {
      const themeName = document.getElementById('colorTheme').value;
      const themeNames = {
        green: 'ç·‘',
        monochrome: 'ãƒ¢ãƒãƒˆãƒ¼ãƒ³',
        blue: 'é’',
        red: 'èµ¤'
      };
      
      if (!confirm(`ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã‚’ã€Œ${themeNames[themeName]}ã€ã«å¤‰æ›´ã—ã¾ã™ã‹?\n\næ—¢å­˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å‰Šé™¤ã•ã‚Œã€æ–°ã—ã„ãƒ†ãƒ¼ãƒã§å†ä½œæˆã•ã‚Œã¾ã™ã€‚`)) {
        return;
      }

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            let message = `âœ… ${result.message}<br><br>`;
            message += `<a href="${result.templateUrl}" target="_blank">æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é–‹ã</a>`;
            showResult(true, message);
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .changeTemplateColorTheme(themeName);
    }

    function fixTemplates() {
      if (!confirm('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰{{period}}ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹?\n\nã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
        return;
      }

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            showResult(true, result.message);
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .fixTemplatesRemovePeriodPlaceholder();
    }

    function fixTemplatesTitle() {
      if (!confirm('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¡¨ç´™ã‚¿ã‚¤ãƒˆãƒ«ã‚’{{reportTitle}}ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«çµ±ä¸€ã—ã¾ã™ã‹?\n\næ—¢å­˜ã®ã€Œæœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆã€ãªã©ã®å›ºå®šãƒ†ã‚­ã‚¹ãƒˆãŒ{{reportTitle}}ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚')) {
        return;
      }

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            showResult(true, result.message);
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .fixTemplatesReportTitlePlaceholder();
    }

    function deleteTemplates() {
      if (!confirm('ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹?\n\næœˆæ¬¡ãƒ»å¹´æ¬¡ãƒ»é€±æ¬¡ã®ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚\nå‰Šé™¤å¾Œã¯ã€Œæ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã€ãƒœã‚¿ãƒ³ã§å†ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
        return;
      }

      showLoading();
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          if (result.success) {
            showResult(true, result.message);
            // è¨­å®šã‚’å†èª­ã¿è¾¼ã¿
            loadCurrentConfig();
          } else {
            showResult(false, result.message);
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showResult(false, 'ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .deleteAllTemplates();
    }

    function showLoading() {
      document.getElementById('loading').classList.add('show');
      document.getElementById('result').classList.remove('show');
    }

    function hideLoading() {
      document.getElementById('loading').classList.remove('show');
    }

    function showResult(success, message) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = message;
      resultDiv.className = 'result show ' + (success ? 'success' : 'error');
    }
  </script>
</body>
</html>
