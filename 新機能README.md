# 📊 スライドレポート自動生成システム（Gemini AI対応版）

Google Apps Scriptを使用して、スプレッドシートのデータから**Googleスライドを自動生成・更新**するシステムです。

## ✨ 主な機能

### 1. 🎨 スライド生成・更新
- **初回**: テンプレートから新規スライド作成 → IDを自動保存
- **2回目以降**: 同じスライドを更新（同じURLで上書き）
- **強制新規作成**: チェックボックスで新規作成も可能

### 2. 🎲 ダミーデータ生成
- **地域別売上**: 8地域（北海道〜九州）+ 棒グラフ
- **担当者別売上**: 8名の担当者 + 横棒グラフ
- **商品別売上**: 7製品 + 円グラフ

3〜4枚のスライドが作成できるデータを簡単に生成！

### 3. 📅 期間選択機能
- **月次レポート**: 月単位のレポート
- **週次レポート**: 週単位のレポート
- **年次レポート**: 年単位のレポート

ボタン1つで期間タイプを切り替え可能！

### 4. 🤖 Gemini AI連携（最大の特徴！）
- **サイドバーからAIアシスタント起動**
- **自動コメント生成**: 売上データからポジティブなコメントを生成
- **インサイト生成**: データ分析からビジネスインサイトを生成
- **カスタムプロンプト**: 自由なプロンプトでテキスト生成

## 🚀 セットアップ手順

### ステップ1: ファイル配置

Google Apps Scriptエディタに以下のファイルを配置:

- `Code.gs` - メインコード
- `MainDialog.html` - スライド生成ダイアログ
- `SettingsDialog.html` - 設定ダイアログ
- `DummyDataDialog.html` - ダミーデータ生成ダイアログ
- `AISidebar.html` - AI アシスタントサイドバー

### ステップ2: スライドテンプレート作成

1. 新しいGoogleスライドを作成
2. 4枚のスライドを作成し、以下の変数を配置:

#### Slide 1: 表紙
```
{{reportTitle}}
{{period}}
Generated at {{generatedAt}}
```

#### Slide 2: サマリー
```
タイトル: 売上サマリー

合計売上: {{totalSales}}
成長率: {{totalSalesChange}}

トップ地域: {{topRegion}} ({{topRegionSales}})
トップ担当者: {{topPerson}} ({{topPersonSales}})

AIコメント:
{{aiComment}}
```

#### Slide 3: 地域別・担当者別
```
タイトル: 詳細分析

（左側: 地域別チャートエリア）
（右側: 担当者別チャートエリア）
```

#### Slide 4: インサイト
```
タイトル: インサイト

{{aiInsight}}
```

3. テンプレートのIDをコピー
   - URL: `https://docs.google.com/presentation/d/【ここがID】/edit`

### ステップ3: Gemini APIキーの取得（任意）

1. [Google AI Studio](https://makersuite.google.com/app/apikey) にアクセス
2. 「Create API Key」をクリック
3. APIキーをコピー

### ステップ4: 設定

1. スプレッドシートを開く
2. メニュー「📊 スライドレポート」→「⚙️ 設定」を選択
3. 以下を入力:
   - **レポートタイトル**: 例: `月次売上レポート`
   - **スライドテンプレートID**: ステップ2でコピーしたID
   - **出力先フォルダID**: （任意）保存先フォルダのID
   - **Gemini APIキー**: ステップ3で取得したAPIキー
4. 「💾 保存」をクリック

### ステップ5: ダミーデータ生成

1. メニュー「📊 スライドレポート」→「🎲 ダミーデータ生成」を選択
2. 生成したいデータを選択:
   - ✅ 地域別売上データ
   - ✅ 担当者別売上データ
   - ✅ 商品別売上データ
3. 「🚀 生成開始」をクリック

## 💡 使い方

### スライド生成・更新

1. メニュー「📊 スライドレポート」→「🎨 スライド生成・更新」を選択
2. 期間タイプを選択（📆 月次 / 📅 週次 / 📊 年次）
3. 対象日を選択
4. 必要に応じて「強制的に新規作成する」にチェック
5. 「🚀 生成・更新」をクリック

**初回**: 新しいスライドが作成され、IDが保存されます
**2回目以降**: 同じスライドが更新されます（同じURL）

### AI アシスタントを使う

1. メニュー「📊 スライドレポート」→「🤖 AI アシスタント」を選択
2. サイドバーが開きます
3. 以下から選択:
   - **💬 売上コメントを生成**: データから自動コメント生成
   - **💡 インサイトを生成**: ビジネスインサイトを生成
   - **✍️ カスタム生成**: 自由なプロンプトでテキスト生成

生成されたテキストは「📋 コピー」ボタンでクリップボードにコピーできます！

## 📊 データ構造

### RegionalSales シート
| Region | Sales | Target | Achievement |
|--------|-------|--------|-------------|
| 北海道 | 1200000 | 1000000 | 1.2 |
| 東北 | 1800000 | 1500000 | 1.2 |
| ... | ... | ... | ... |

### PersonSales シート
| Person | Sales | Deals | AvgDealSize |
|--------|-------|-------|-------------|
| 田中太郎 | 5000000 | 15 | 333333 |
| 佐藤花子 | 4500000 | 12 | 375000 |
| ... | ... | ... | ... |

### ProductSales シート
| Product | Sales | Units | UnitPrice |
|---------|-------|-------|-----------|
| 製品A | 3000000 | 100 | 30000 |
| 製品B | 2500000 | 50 | 50000 |
| ... | ... | ... | ... |

## 🎯 スライド変数一覧

テンプレートで使用できる変数:

| 変数 | 説明 | 例 |
|------|------|-----|
| `{{reportTitle}}` | レポートタイトル | 月次売上レポート |
| `{{period}}` | 期間 | 2026年01月 |
| `{{generatedAt}}` | 生成日時 | 2026-01-10 15:30 |
| `{{totalSales}}` | 合計売上 | 14,500,000円 |
| `{{totalSalesChange}}` | 成長率 | +15.0% |
| `{{topRegion}}` | トップ地域 | 関東 |
| `{{topRegionSales}}` | トップ地域売上 | 5,200,000円 |
| `{{topPerson}}` | トップ担当者 | 田中太郎 |
| `{{topPersonSales}}` | トップ担当者売上 | 5,000,000円 |
| `{{aiComment}}` | AIコメント | （AIが生成） |
| `{{aiInsight}}` | AIインサイト | （AIが生成） |

## 🛠️ トラブルシューティング

### エラー: "スライドテンプレートIDが設定されていません"
→ 設定ダイアログからテンプレートIDを登録してください

### エラー: "Gemini APIキーが設定されていません"
→ 設定ダイアログからAPIキーを登録してください（AI機能を使う場合のみ必要）

### スライドが更新されない
→ 「強制的に新規作成する」にチェックを入れて実行してください

### スライドIDをリセットしたい
→ 設定ダイアログの「🔄 リセット」ボタンをクリックしてください

## 🔧 スクリプトプロパティ

設定は**スクリプトプロパティ**に保存されます:

- `SLIDE_TEMPLATE_ID`: スライドテンプレートID
- `CURRENT_SLIDE_ID`: 現在のスライドID（自動更新）
- `OUTPUT_FOLDER_ID`: 出力先フォルダID
- `GEMINI_API_KEY`: Gemini APIキー
- `REPORT_TITLE`: レポートタイトル
- `PERIOD_TYPE`: 期間タイプ

これにより、**複数のスプレッドシート間で設定を共有しません**（独立した設定）。

## 📝 注意事項

- Gemini API無料枠: 1分あたり60リクエストまで
- スライド更新時、既存のスライドは上書きされます
- スクリプトプロパティはプロジェクト単位で保存されます

## 🎉 完成！

これで、AIを使った高度なスライドレポート自動生成システムが完成しました！

ダミーデータを生成して、AI機能を試してみてください！
