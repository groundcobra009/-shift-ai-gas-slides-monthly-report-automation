# 📊 スライドレポート自動生成システム

Google Apps Scriptで、CSVデータから美しいスライドレポートを自動生成するシステムです。Gemini AI連携により、インサイトも自動生成できます。

## ✨ 主な機能

### 📥 データインポート・集計
- **CSVインポート**: 売上データをCSV形式で簡単インポート
- **自動集計**: 地域別、担当者別、製品別、カテゴリ別、月次集計を自動生成
- **リアルタイム可視化**: QUERY関数を使った動的なグラフ生成

### 🎨 スライド自動生成
- **4枚構成のモダンデザイン**: 表紙、サマリー、詳細分析、インサイト
- **テンプレートベース**: 一貫性のあるデザインを維持
- **自動チャート挿入**: スプレッドシートのグラフを自動でスライドに挿入

### 🤖 Gemini AI連携
- **自動コメント生成**: 売上サマリーコメントをAIが自動生成
- **ビジネスインサイト**: データ分析と具体的なアクションプランを提案
- **カスタムプロンプト対応**: 自由なプロンプトでAIテキスト生成
- **Gemini 2.5 Flash使用**: 高速で高性能なAIモデル

### ⚙️ 簡単セットアップ
- **ワンクリックセットアップ**: テンプレートと出力フォルダを自動作成
- **GUI設定画面**: スクリプトプロパティを直感的に管理
- **接続テスト機能**: Gemini APIの接続確認が簡単

## 🚀 クイックスタート

### 1. 初期セットアップ

1. **Google Sheetsで開く**
   - 新しいスプレッドシートを作成
   - 「拡張機能」→「Apps Script」でスクリプトエディタを開く
   - `Code.gs`の内容をコピー＆ペースト

2. **HTMLファイルの追加**
   - 以下のHTMLファイルをスクリプトエディタに追加:
     - `SettingsSidebar.html`
     - `AISidebar.html`
     - `MainSidebar.html`
     - `DummyDataDialog.html`
     - `HelpDialog.html`

3. **セットアップ実行**
   - スプレッドシートに戻り、メニュー「📊 スライドレポート」→「⚙️ 設定」を開く
   - 「⚡ セットアップ実行」ボタンをクリック
   - テンプレートスライドと出力フォルダが自動作成されます

### 2. Gemini API設定（オプション）

1. **APIキー取得**
   - [Google AI Studio](https://makersuite.google.com/app/apikey)にアクセス
   - 「Create API Key」をクリック
   - APIキーをコピー

2. **APIキー設定**
   - 「⚙️ 設定」サイドバーの「Gemini APIキー」欄にペースト
   - 「💾 設定を保存」をクリック
   - 「🔌 Gemini接続テスト」で動作確認

### 3. データインポート

1. **CSVデータ準備**
   - 必須カラム: `Date, Region, Person, Product, Category, Quantity, UnitPrice, TotalSales`
   - サンプルデータ生成機能も利用可能

2. **インポート実行**
   - メニュー「📊 スライドレポート」→「🎲 ダミーデータ生成」
   - または「📊 レポート生成」からCSVをアップロード

3. **集計シート確認**
   - `RawSalesData`: 生データ
   - `RegionalSales`: 地域別集計
   - `PersonSales`: 担当者別集計
   - `ProductSales`: 製品別集計
   - `CategorySales`: カテゴリ別集計
   - `MonthlySales`: 月次集計

### 4. レポート生成

1. **レポート生成画面を開く**
   - メニュー「📊 スライドレポート」→「📊 レポート生成」

2. **AIコメント生成（オプション）**
   - 「💬 売上サマリーコメントを生成」をクリック
   - 「💡 ビジネスインサイトを生成」をクリック

3. **スライド生成**
   - 「新規作成」または「既存更新」を選択
   - 「📊 レポート生成」ボタンをクリック

## 📋 データ構造

### RawSalesData（生データ）
```csv
Date,Region,Person,Product,Category,Quantity,UnitPrice,TotalSales
2025-01-01,関東,田中太郎,製品A,サブスク,10,50000,500000
2025-01-02,関西,鈴木花子,製品B,単発,5,100000,500000
```

### 集計シート（自動生成）

#### RegionalSales
```
地域    | 売上
--------|----------
関東    | 5200000
関西    | 2800000
```

#### PersonSales
```
担当者   | 売上    | 件数 | 平均単価
---------|---------|------|----------
田中太郎 | 3200000 | 15   | 213333
鈴木花子 | 2800000 | 12   | 233333
```

#### ProductSales
```
製品   | 売上    | 販売数 | 平均単価
-------|---------|--------|----------
製品A  | 3200000 | 64     | 50000
製品B  | 2800000 | 28     | 100000
```

## 🎨 スライド構成

### Slide 1: 表紙
- レポートタイトル
- 対象期間
- 生成日時

### Slide 2: サマリー
- 合計売上
- 成長率
- トップ地域・担当者
- AIコメント（Gemini生成）

### Slide 3: 詳細分析
- 地域別売上グラフ（棒グラフ）
- 担当者別売上グラフ（棒グラフ）

### Slide 4: インサイト
- AIビジネスインサイト（Gemini生成）
- 具体的なアクションプラン

## 🔧 設定項目

### スクリプトプロパティ
| 項目 | 説明 | 例 |
|------|------|-----|
| SLIDE_TEMPLATE_ID | スライドテンプレートID | 自動設定 |
| CURRENT_SLIDE_ID | 最後に生成したスライドID | 自動更新 |
| OUTPUT_FOLDER_ID | 出力先フォルダID | 自動設定 |
| GEMINI_API_KEY | Gemini APIキー | 手動設定 |
| REPORT_TITLE | レポートタイトル | 月次売上レポート |
| PERIOD_TYPE | 期間タイプ | monthly |

## 🤖 Gemini AI機能

### 自動生成される内容

#### 売上サマリーコメント（150文字以内）
```
1月の売上は14,500,000円（前月比+15.0%）を達成。
トップ地域の関東が5,200,000円、トップ担当者の田中太郎が3,200,000円と好調。
```

#### ビジネスインサイト（200文字程度）
```
【強み】関東地域が全体の36%を占め、安定した売上基盤を確立。
【課題】四国・中国地域の売上が低迷（合計8%）。
【提案】
1. 関東の成功事例を他地域に横展開
2. 低迷地域への営業リソース強化
3. トップ担当者のノウハウ共有会を実施
```

### カスタムプロンプト
自由なプロンプトでAIテキストを生成できます。
```
例: 「売上データから今月の傾向と来月の改善提案を200文字程度でまとめてください」
```

## 📊 集計機能の仕様

### QUERY関数による動的集計
- データ追加・更新時に自動再計算
- 複雑な集計ロジックをSQL風のシンタックスで実装
- グラフも自動更新

### 生成される集計シート
1. **RegionalSales**: 地域別売上（降順）
2. **PersonSales**: 担当者別売上、件数、平均単価
3. **ProductSales**: 製品別売上、販売数、平均単価
4. **CategorySales**: カテゴリ別売上
5. **MonthlySales**: 月次売上推移、前月比、前月比率

### グラフの種類
- 地域別: 棒グラフ（カラフル）
- 担当者別: 横棒グラフ
- 製品別: 円グラフ
- 月次推移: 折れ線グラフ

## 🛠️ 開発者向け情報

### 主要関数

#### セットアップ
```javascript
setupInitialEnvironment()  // 初期セットアップ（テンプレート＆フォルダ作成）
updateSlideTemplate()      // テンプレート更新
```

#### データ管理
```javascript
importAndAggregateSalesData(csvText)  // CSV インポート＆集計
refreshAggregationSheets()             // 集計シート更新
getReportData_(periodType, targetDate) // レポートデータ取得
```

#### スライド生成
```javascript
generateOrUpdateSlide(params)  // スライド生成・更新
createNewSlide_(config, data)  // 新規スライド作成
updateSlide_(presentation, data) // 既存スライド更新
```

#### Gemini AI
```javascript
generateTextWithGemini(prompt, customPrompt)  // Gemini テキスト生成
generateAIComment()     // 売上コメント生成
generateAIInsight()     // ビジネスインサイト生成
testGeminiConnection()  // 接続テスト
```

### ファイル構成
```
gas-slides-monthly-report-automation/
├── Code.gs                    # メインスクリプト
├── AISidebar.html            # AI機能UI
├── SettingsSidebar.html      # 設定UI
├── MainSidebar.html          # レポート生成UI
├── DummyDataDialog.html      # ダミーデータ生成UI
├── HelpDialog.html           # ヘルプUI
├── README.md                 # このファイル
└── 要件定義書.md             # 詳細仕様書
```

## 🎯 使用例

### 月次レポート自動化
1. 月初にCSVデータをエクスポート
2. システムにインポート
3. AIコメント＆インサイトを生成
4. スライドを自動生成
5. 経営会議で使用

### データ分析
1. 集計シートで傾向を確認
2. グラフで可視化
3. AIにインサイトを依頼
4. アクションプランを策定

## 🔒 セキュリティ

- APIキーはスクリプトプロパティに暗号化保存
- UI上ではマスク表示（`****...****`）
- Gemini APIは読み取り専用で使用

## 📝 ライセンス

MIT License

## 🤝 コントリビューション

プルリクエスト歓迎！バグ報告やフィードバックもお待ちしています。

## 📮 サポート

問題が発生した場合:
1. `HelpDialog`（ヘルプ）を確認
2. 要件定義書で詳細仕様を確認
3. Issueを作成

## 🌟 今後の予定

- [ ] トリガー機能（定期実行）
- [ ] 複数期間の比較レポート
- [ ] カスタムテンプレート対応
- [ ] より高度なAI分析機能
- [ ] エクスポート機能（PDF）

---

**作成日**: 2026-01-11
**バージョン**: 2.0
**対応モデル**: Gemini 2.5 Flash
